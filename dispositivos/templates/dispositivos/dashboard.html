<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard EcoEnergy</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #e8e8e8;
            color: #333;
        }
        
        /* Header negro */
        header {
            background-color: #2c2c2c;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-brand {
            color: white;
            font-size: 16px;
            font-weight: bold;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .nav-links a {
            color: #999;
            text-decoration: none;
            font-size: 14px;
            padding: 5px 10px;
        }
        
        .nav-links a.active,
        .nav-links a:hover {
            color: white;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
        }
        
        .auth-buttons a {
            color: white;
            text-decoration: none;
            font-size: 14px;
            padding: 6px 15px;
            border: 1px solid #555;
            border-radius: 4px;
        }
        
        .dashboard {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }
        
        /* Paneles con fondo blanco */
        .panel {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .panel h2 {
            font-size: 14px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Lista de categorías y zonas */
        .category-list, .zone-list {
            list-style: none;
        }
        
        .category-item, .zone-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .category-item:last-child, .zone-item:last-child {
            border-bottom: none;
        }
        
        .item-name {
            font-size: 14px;
            color: #333;
        }
        
        .item-count {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        
        /* Panel de alertas */
        .alerts-badges {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .severity-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Colores exactos de la foto */
        .severity-critica { background-color: #333; }  /* Negro/gris oscuro */
        .severity-alta { background-color: #666; }     /* Gris medio */
        .severity-media { background-color: #999; }    /* Gris claro */
        
        .alert-description {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        /* Sección completa para mediciones y alertas */
        .full-width-section {
            grid-column: span 3;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        /* Tabla de mediciones */
        .measurements-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .measurements-table th {
            background-color: #f8f8f8;
            padding: 10px;
            text-align: left;
            font-weight: bold;
            color: #333;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .measurements-table td {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            color: #333;
        }
        
        .device-name {
            color: #0066cc;
            text-decoration: underline;
            cursor: pointer;
        }
        
        /* Alertas recientes */
        .alert-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .alert-info {
            flex: 1;
        }
        
        .alert-device {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }
        
        .alert-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .alert-active { 
            background-color: #333; 
            color: white; 
        }
        
        .alert-resolved { 
            background-color: #666; 
            color: white; 
        }
        
        .ver-mas {
            color: #0066cc;
            text-decoration: none;
            font-size: 14px;
            margin-top: 10px;
            display: inline-block;
        }
        
        .ver-mas:hover {
            text-decoration: underline;
        }
        
        /* Footer */
        footer {
            background-color: #2c2c2c;
            color: #999;
            padding: 15px;
            text-align: center;
            font-size: 12px;
            margin-top: 40px;
        }
        
        footer a {
            color: white;
            text-decoration: none;
        }
        
        /* Responsive */
        @media (max-width: 1000px) {
            .dashboard {
                grid-template-columns: 1fr 1fr;
            }
            .full-width-section {
                grid-column: span 2;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
                padding: 0 15px;
            }
            .full-width-section {
                grid-column: span 1;
                grid-template-columns: 1fr;
            }
            .nav-links {
                display: none;
            }
        }
    </style>
</head>
<body>

<header>
    <div class="nav-brand">EcoEnergy</div>
    <div class="nav-links">
        <a href="{% url 'dashboard' %}" class="active">Dashboard</a>
        <a href="{% url 'device_list' %}">Dispositivos</a>
        <a href="{% url 'measurement_list' %}">Mediciones</a>
    </div>
    <div class="auth-buttons">
        <a href="{% url 'login' %}">Iniciar sesión</a>
        <a href="{% url 'register' %}">Registrarse</a>
    </div>
</header>

<div class="dashboard">
    <!-- Dispositivos por Categoría -->
    <div class="panel">
        <h2>Dispositivos por Categoría</h2>
        <div class="category-list">
            {% for item in devices_by_category %}
                <div class="category-item">
                    <span class="item-name">{{ item.id_cat__name }}</span>
                    <span class="item-count">{{ item.total }}</span>
                </div>
            {% empty %}
                <div class="category-item">
                    <span class="item-name">Categoría A</span>
                    <span class="item-count">12</span>
                </div>
                <div class="category-item">
                    <span class="item-name">Categoría B</span>
                    <span class="item-count">7</span>
                </div>
                <div class="category-item">
                    <span class="item-name">Categoría C</span>
                    <span class="item-count">4</span>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Dispositivos por Zona -->
    <div class="panel">
        <h2>Dispositivos por Zona</h2>
        <div class="zone-list">
            {% for item in devices_by_zone %}
                <div class="zone-item">
                    <span class="item-name">{{ item.id_zone__name }}</span>
                    <span class="item-count">{{ item.total }}</span>
                </div>
            {% empty %}
                <div class="zone-item">
                    <span class="item-name">Zona Norte</span>
                    <span class="item-count">8</span>
                </div>
                <div class="zone-item">
                    <span class="item-name">Zona Centro</span>
                    <span class="item-count">9</span>
                </div>
                <div class="zone-item">
                    <span class="item-name">Zona Sur</span>
                    <span class="item-count">6</span>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Alertas de la Semana -->
    <div class="panel">
        <h2>Alertas de la Semana</h2>
        <div class="alerts-badges">
            {% for item in alerts_by_severity %}
                <div class="severity-badge severity-{{ item.id_alert__severity|lower }}">
                    <span>{{ item.id_alert__severity }}</span>
                    <strong>{{ item.total }}</strong>
                </div>
            {% empty %}
                <div class="severity-badge severity-critica">
                    <span>Crítica</span>
                    <strong>2</strong>
                </div>
                <div class="severity-badge severity-alta">
                    <span>Alta</span>
                    <strong>5</strong>
                </div>
                <div class="severity-badge severity-media">
                    <span>Media</span>
                    <strong>3</strong>
                </div>
            {% endfor %}
        </div>
        <div class="alert-description">
            * Criterios de severidad configurables por dispositivo
        </div>
    </div>

    <!-- Sección completa para mediciones y alertas -->
    <div class="full-width-section">
        <!-- Últimas Mediciones -->
        <div class="panel">
            <h2>Últimas 10 Mediciones</h2>
            <table class="measurements-table">
                <thead>
                    <tr>
                        <th>Fecha/Hora</th>
                        <th>Dispositivo</th>
                        <th>Valor</th>
                    </tr>
                </thead>
                <tbody>
                    {% for m in recent_measurements %}
                        <tr>
                            <td>{{ m.timestamp|date:"Y-m-d H:i" }}</td>
                            <td class="device-name">{{ m.device.name }}</td>
                            <td>{{ m.value }} {{ m.unit }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td>2025-08-25 10:02</td>
                            <td class="device-name">Disp-001</td>
                            <td>230.5</td>
                        </tr>
                        <tr>
                            <td>2025-08-25 09:57</td>
                            <td class="device-name">Disp-002</td>
                            <td>218.2</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <a href="{% url 'measurement_list' %}" class="ver-mas">Ver todas</a>
        </div>

        <!-- Alertas Recientes -->
        <div class="panel">
            <h2>Alertas Recientes</h2>
            <div class="recent-alerts">
                <div class="alert-item">
                    <div class="alert-info">
                        <div class="alert-device">Disp-004</div>
                        <div class="alert-description">Valor fuera de rango (min: 200, máx: 250)</div>
                    </div>
                    <span class="alert-status alert-active">Activa</span>
                </div>
                <div class="alert-item">
                    <div class="alert-info">
                        <div class="alert-device">Disp-002</div>
                        <div class="alert-description">Dispositivo sostenido</div>
                    </div>
                    <span class="alert-status alert-resolved">Error</span>
                </div>
            </div>
            <a href="{% url 'alert_list' %}" class="ver-mas">Ver todas</a>
        </div>
    </div>
</div>

<footer>
    © 2025 EcoEnergy
    <span style="float: right;">
        <a href="#">Soporte</a>
    </span>
</footer>

</body>
</html>